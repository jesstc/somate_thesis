<body class="home_body">
    <div class="container-fluid">
        <div class="home-div">
            <div class="logo-title">
                <img src="/SoMate-logo.png" width="100%">
            </div>

            <div class="home-prompt">
                <h3 class="font"><%= prompt_text %></h3>
            </div>

            <div class="visualization-div">
                <!-- Viz 1 -->
                <div class="visualization-card">
                    <div class="page-title" style="width:100%;">
                        <a href="/index/<%= account %>/<%= Date.strptime(date_start, '%m/%d') - 7 %>">
                            <img src="/date-left-arrow.png" width="18px">
                        </a>
                        <p class="font remark-string" align="center" style="color: #A4A1A1;">
                            <%= date_start %>（一）～ <%= date_end %>（日）
                        </p>
                        <a href="/index/<%= account %>/<%= Date.strptime(date_start, '%m/%d') + 7 %>">
                            <img src="/date-right-arrow.png" width="18px">
                        </a>
                    </div>
                    <h3 class="font viz-title">使用時間與情緒</h3>
                    <div class="timeemo-viz-div">
                        <% if has_data %>
                            <canvas id="viz-1-chart" ></canvas>
                        <% else %>
                            <p class="font content no-record-text">查無紀錄資料</p>
                        <% end %>
                    </div>
                </div>

                <!-- Viz 2 -->
                <div class="visualization-card">
                    <div class="page-title" style="width:100%;">
                        <a href="/index/<%= account %>/<%= Date.strptime(date_start, '%m/%d') - 7 %>">
                            <img src="/date-left-arrow.png" width="18px">
                        </a>
                        <p class="font remark-string" align="center" style="color: #A4A1A1;">
                            <%= date_start %>（一）～ <%= date_end %>（日）
                        </p>
                        <a href="/index/<%= account %>/<%= Date.strptime(date_start, '%m/%d') + 7 %>">
                            <img src="/date-right-arrow.png" width="18px">
                        </a>
                    </div>

                    <div class="viz-2-div">
                        <h3 class="font viz-title">我通常在 IG 做的事</h3>
                        <div class="activities-viz-div">
                            <% if has_data %>
                                <% viz_2[:activities].each_with_index do |activity, index| %>
                                    <% if index < viz_2[:activity_max] %>
                                        <div class="activities-viz-line">
                                            <div class="activities-viz-num"><%= index + 1 %></div>
                                            <div class="font content activities-viz-text"><%= activity[0] %></div>
                                        </div>
                                    <% end %>
                                <% end %>
                            <% else %>
                                <p class="font content no-record-text" style="height: 20vw">查無紀錄資料</p>
                            <% end %>
                        </div>

                        <h3 class="font viz-title">常用 IG 的時段</h3>
                        
                        <div class="my-badge-div">
                        <% if has_data %>
                            <% viz_2[:moments].each_with_index do |moment, index| %>
                                <% if index < viz_2[:moment_max] %>
                                    <div class="font my-badge"><%= moment[0] %></div>
                                <% end %>
                            <% end %>
                        <% else %>
                            <p class="font content no-record-text" style="height: 20vw">查無紀錄資料</p>
                        <% end %>
                        </div>
                    </div>
                    
                </div>

                <!-- Viz 3 -->
                <div class="visualization-card">
                    <div class="page-title" style="width:100%;">
                        <a href="/index/<%= account %>/<%= Date.strptime(date_start, '%m/%d') - 7 %>">
                            <img src="/date-left-arrow.png" width="18px">
                        </a>
                        <p class="font remark-string" align="center" style="color: #A4A1A1;">
                            <%= date_start %>（一）～ <%= date_end %>（日）
                        </p>
                        <a href="/index/<%= account %>/<%= Date.strptime(date_start, '%m/%d') + 7 %>">
                            <img src="/date-right-arrow.png" width="18px">
                        </a>
                    </div>
                    <h3 class="font viz-title">我在 IG 做的事與情緒</h3>
                        <% if has_data %>
                            <div class="viz-3-div">
                                <canvas id="viz-3-chart" ></canvas>
                                <div class="not-done-activities">
                                    <p class="font remark-string">我上週在 IG 沒做的事情</p>
                                    <% if viz_3[:activities_havenot_done].length !=0 %>
                                        <div class="my-badge-div">
                                        <% viz_3[:activities_havenot_done].each do |activity| %>
                                            <div class="viz-3-badge font my-badge" style="color: #A4A1A1; border: 1.5px solid #A4A1A1; font-size: 10px; line-height: 14px; padding: 3px 8px;">
                                                <%= activity %>
                                            </div>
                                        <% end %>
                                        </div>
                                    <% end %>
                                </div>
                            </div>
                        <% else %>
                            <p class="font content no-record-text">查無紀錄資料</p>
                        <% end %>
                    
                </div>

                <!-- Viz 4 -->
                <div class="visualization-card">
                    <div class="page-title" style="width:100%;">
                        <a href="/index/<%= account %>/<%= Date.strptime(date_start, '%m/%d') - 7 %>">
                            <img src="/date-left-arrow.png" width="18px">
                        </a>
                        <p class="font remark-string viz-4-date" align="center" style="color: #A4A1A1;" start-date="<%= date_start %>" end-date="<%= date_end %>">
                            <%= date_start %>（一）～ <%= date_end %>（日）
                        </p>
                        <a href="/index/<%= account %>/<%= Date.strptime(date_start, '%m/%d') + 7 %>">
                            <img src="/date-right-arrow.png" width="18px">
                        </a>
                    </div>
                    <h3 class="font">我身體的感受與情緒</h3>
                    <div class="emofeel-viz-div">
                        <% if has_data %>
                            <!-- <img src="/viz-body.svg" height="95%"> -->
                            <!-- bodyparts viz svg tags -->
                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 152.34 250" height="95%">
                                <defs>
                                    <style>
                                    .cls-1,.cls-2{stroke:#484848;}.cls-2{stroke-linejoin:round;}.cls-3,.cls-4{fill:#484848;}.cls-4{fill-rule:evenodd;}.cls-5{fill:url(#未命名漸層);}.cls-6{fill:#a4a1a1;}
                                    </style>
                                    <linearGradient id="未命名漸層" x1="1.73" y1="0.79" x2="72.6" y2="3.99" gradientTransform="matrix(1, 0, 0, -1, 0, 249.89)" gradientUnits="userSpaceOnUse">
                                        <stop offset="0" stop-color="#fef8ea"/>
                                        <stop offset="1" stop-color="#ffbc11"/>
                                    </linearGradient>
                                </defs>
                                <g id="圖層_2" data-name="圖層 2">
                                    <g id="viz-body-svg">
                                        <path id="E" class="cls-1 E" fill="#f6f6f6" d="M104.23,65.56c-.92-1.08-.63-2.57-.42-3.66a11,11,0,0,1,2-4.22,14.48,14.48,0,0,1,2.3-2.76c.53-.49.86-.72,2.16-1.82.69-.6,1.25-1.09,1.61-1.42a42.26,42.26,0,0,1,5.45,10.84c1.29,3.76,3.57,8.27,8.13,17.27,3.55,7,3.74,6.91,5,10,1.05,2.5,1.76,4.58,3.84,9.48s2.6,5.77,3.46,6.75c1.33,1.48,1.43,1,6.21,4.87a6,6,0,0,0,2.77,1.64c.1,0,2.2.6,3.93.86.29.05.94.15,1.13.51.06.16-.06.29-.08.45a.89.89,0,0,1-.19.46,1.41,1.41,0,0,1-1.37.87c-1.22.09-3-.73-4-.71a17,17,0,0,0-1.89.15,12.56,12.56,0,0,0,1.12,2.68,22.62,22.62,0,0,0,2.49,3.31c.51.62,1.67,2.2,2.52,3.18a.8.8,0,0,1,.06.48.91.91,0,0,1-.19.45,2,2,0,0,1-.86.44,1,1,0,0,1-.68-.2c-.71-.55-1.91-1.91-2.67-2.61a28.82,28.82,0,0,1-2-2.36.41.41,0,0,0-.26-.19.4.4,0,0,0-.32,0,.29.29,0,0,0-.12.1.39.39,0,0,0-.08.14.49.49,0,0,0,0,.17.88.88,0,0,0,0,.15c-.06,1.53,1.5,3.28,1.83,4a13.86,13.86,0,0,1,1.29,2.35,1.32,1.32,0,0,1-.3,1.27,3.67,3.67,0,0,1-1.14.6l-.64-1.06c-1.64-2.73-2.56-4.28-2.8-4.78a17.31,17.31,0,0,1-.91-2.33c-.19-.12-.44-.23-.58-.14s-.07.7.3,1.64a41.54,41.54,0,0,0,2,3.91,13.67,13.67,0,0,1,.91,2.51c-.18.23-.59,1-.88,1.07-.51,0-.94-.42-1.39-1a19.11,19.11,0,0,1-2.37-4.44c-.2-.46-.45-1.39-.7-2-.14-.1-.14-.39-.31-.38a.84.84,0,0,0-.46.2.74.74,0,0,0-.19.36c0,.13-.09.35,0,.47a6.06,6.06,0,0,0,.9,3.25,2.51,2.51,0,0,1,.47,1.44,3,3,0,0,1-.95.65c-.47.17-1.28-1-1.41-1.18a8.88,8.88,0,0,1-1.73-4.77,25.39,25.39,0,0,1-.52-3.52c-.06-1.14-.5-2.5-.63-4a40.93,40.93,0,0,0-.41-4.49s0-.18-.13-.44c0,0-.15-.5-.35-1s-1.63-3.34-5.66-10.26l-6.66-12c-3.76-6.82-5.07-9.23-7.45-12.53A71.62,71.62,0,0,0,106,66.53,3.21,3.21,0,0,1,104.23,65.56Z"/>
                                        <path id="A" class="cls-2 A" fill="#f6f6f6" d="M73.07,11.47a.5.5,0,0,0-.54-.16.48.48,0,0,0-.34.44c0,.49-.1,1-.18,1.37L72,13a7.79,7.79,0,0,1-.35-1.85,8,8,0,0,1,1.84-5.11c2.16-2.81,5.25-3.72,7.9-4.49A29.36,29.36,0,0,1,88.64.63c4-.19,5.83-.28,7.94.55h0a12.42,12.42,0,0,1,5.23,4.12c4.17,5.39,3,12.22,2.62,14.17A21.77,21.77,0,0,1,101.57,27a48.18,48.18,0,0,1-8.13-2.06,49.74,49.74,0,0,1-10.58-5.2h0A40.42,40.42,0,0,1,75,13.58h0C74.16,12.74,73.52,12,73.07,11.47ZM96.76.72Z"/>
                                        <path id="B" class="cls-1 B" fill="#f6f6f6" d="M74.35,20.49h0A4.34,4.34,0,0,1,73.91,22l-.15.3a12.67,12.67,0,0,0,2.25-.6h0a7.6,7.6,0,0,0,2.36-1.27c.19-.16.37-.33.55-.5-.37-.28-.83-.64-1.33-1.06h0a37.09,37.09,0,0,1-3.43-3.36L74,15.36l-.27-.29v.08Zm0,0h0m0,0h0"/>
                                        <path id="C" class="cls-2 C" fill="#f6f6f6" d="M100.58,29.14l-.52.71h0l-1.35,1.73-.12.15-1.28,1.6a51.15,51.15,0,0,0-6.43.4h0a55.9,55.9,0,0,0-8,1.37h0a14.5,14.5,0,0,1-5.07.57A3,3,0,0,1,76.11,35h0a2.6,2.6,0,0,1-.81-1.13,3.57,3.57,0,0,1-.17-1v0a4.51,4.51,0,0,1,0-.9.52.52,0,0,0-.12-.36,4.84,4.84,0,0,0-.64-.64l0,0-.1-.1a.51.51,0,0,1-.09-.16v-.51a.49.49,0,0,0-.28-.44l-.12-.06a2.26,2.26,0,0,1,0-.27v-.19c0-.12,0-.23,0-.33a3.88,3.88,0,0,0,0-.9,1.67,1.67,0,0,0-.28-.81l0,0a1,1,0,0,0-.62-.39l-.18,0-.4-.12h0a1.72,1.72,0,0,1-.91-.61h0a.27.27,0,0,1-.08-.19.47.47,0,0,1,.07-.12l0,0a2.9,2.9,0,0,1,.5-.49h0a2.22,2.22,0,0,0,.68-1c.11-.26.13-.29.2-.32a.27.27,0,0,1,.17,0l.2,0h0l.3,0a6.08,6.08,0,0,0,2.47-.39h.06a12.26,12.26,0,0,0,3.45-1.63.19.19,0,0,0,.07-.06l.91-.91,0,0a8,8,0,0,1,1.09.73l0,0c2.15,1.39,3.91,2.33,4.7,2.74A45.48,45.48,0,0,0,91,26.54h0a47.05,47.05,0,0,0,5.88,1.77C98.28,28.67,99.54,28.94,100.58,29.14Z"/>
                                        <path id="D" class="cls-2 D" fill="#f6f6f6" d="M101.24,62.34a14.38,14.38,0,0,1,.8-2.68,14.78,14.78,0,0,1,1.3-2.48h0A18,18,0,0,1,106.14,54h0c.4-.37.71-.62,1-.89l.09-.07c.32-.26.69-.56,1.2-1,.91-.77,1.63-1.45,2.15-2a18.62,18.62,0,0,0-1.93-1.73h0a24.59,24.59,0,0,0-5.14-2.85c-1.22-.54-2-.86-2.74-1.11l-.55-.21a11.22,11.22,0,0,1-2.42-1.25h0a15.77,15.77,0,0,1-2.77-2.56l0,0h0a4.18,4.18,0,0,1-1.29-2.43h0a2.58,2.58,0,0,1,0-.68.49.49,0,0,1,.52-.45,3.84,3.84,0,0,1,1.11.22h0l.31.13,0,0,.05,0h0a.59.59,0,0,0,.31-.09.56.56,0,0,0,.21-.22s0-.09,0-.28v0a2.11,2.11,0,0,1,0-.93h0a1.8,1.8,0,0,1,0-.19c-.53,0-1.16,0-1.87,0a42.73,42.73,0,0,0-5.76.77c-1.06.18-1.86.34-2.58.48-1.29.25-2.32.45-4.05.69l-1,.12a3.93,3.93,0,0,1,.06,1h0A4,4,0,0,1,80,40.9,4.38,4.38,0,0,1,78.28,42c-3.74,1.31-5.64,2-7.6,2.53a32.31,32.31,0,0,0-6.31,2.3h0a13,13,0,0,0-3.17,2.24,12.53,12.53,0,0,0-1.09,1.21c.51.7,1.18,1.66,1.93,2.82h0A20,20,0,0,1,64.31,57a20.72,20.72,0,0,1,1.74,7.5,46.43,46.43,0,0,1,35.19-2.19Z"/>
                                        <path id="F" class="cls-1 F" fill="#f6f6f6" d="M67,78.53h0a17.68,17.68,0,0,0,3,1.93c1.65.83,3.92,1.63,9.31,1.89a81.93,81.93,0,0,0,14.29-.78c2.15-.25,3.94-.51,5.25-.71.15-1.12.39-2.87.56-4.09.07-.53.13-1,.16-1.18h0c.07-.45.12-.87.18-1.28a30.4,30.4,0,0,1,1.6-7.58h0a23.17,23.17,0,0,1,1.06-2.33l-.44-.73-.58-1h0a2.14,2.14,0,0,0-.63-.59,6.3,6.3,0,0,0-1-.52,13.49,13.49,0,0,0-1.91-.61h0a36.59,36.59,0,0,0-4.42-1l-1.94-.19c-1.13-.09-2.62-.18-4.38-.2a47.79,47.79,0,0,0-5.78.24,41.32,41.32,0,0,0-7.09,1.48,43.67,43.67,0,0,0-8.13,3.35Z"/>
                                        <path id="E-2" data-name="E" class="cls-1 E" fill="#f6f6f6" d="M63.15,67.43c1.23-.89,1.28-2.49,1.32-3.67A11.44,11.44,0,0,0,63.35,59a14.75,14.75,0,0,0-1.76-3.36c-.45-.64-.74-1-1.84-2.38l-1.36-1.83a44.38,44.38,0,0,0-8.29,9.88c-2.26,3.57-5.72,7.67-12.65,15.87-5.4,6.39-5.57,6.23-7.63,9.07-1.7,2.33-2.94,4.3-6.28,8.86s-4.1,5.33-5.25,6.13c-1.74,1.22-1.73.67-7.68,3.57a6.39,6.39,0,0,1-3.3,1c-.11,0-2.45.11-4.34,0-.31,0-1-.06-1.3.27-.11.14,0,.3,0,.48a1,1,0,0,0,.09.5A1.51,1.51,0,0,0,3,108.27c1.26.37,3.35,0,4.39.2a19,19,0,0,1,2,.58,13.55,13.55,0,0,1-1.82,2.5,24.5,24.5,0,0,1-3.4,2.83c-.68.51-2.28,1.87-3.4,2.68a1,1,0,0,0-.19.48,1,1,0,0,0,.1.51,2.28,2.28,0,0,0,.8.65,1.11,1.11,0,0,0,.76,0c.88-.4,2.47-1.52,3.43-2.06a30.57,30.57,0,0,0,2.68-2,.46.46,0,0,1,.32-.13.47.47,0,0,1,.32.12.45.45,0,0,1,.1.14.49.49,0,0,1,.05.16.47.47,0,0,1,0,.17.38.38,0,0,1-.09.15c-.29,1.59-2.35,3-2.86,3.66A14.59,14.59,0,0,0,4.16,121a1.39,1.39,0,0,0,0,1.38,3.89,3.89,0,0,0,1.06.88l.92-.94c2.37-2.42,3.7-3.8,4.07-4.27a18,18,0,0,0,1.51-2.18c.24-.08.52-.14.64,0s-.09.74-.7,1.61a45,45,0,0,1-3,3.57,14.26,14.26,0,0,0-1.56,2.37c.14.28.38,1.19.67,1.3.53.17,1.1-.21,1.71-.7a20.63,20.63,0,0,0,3.54-4c.32-.43.8-1.33,1.21-1.9.17-.07.24-.37.42-.31a.79.79,0,0,1,.43.31.65.65,0,0,1,.11.41,1,1,0,0,1-.07.49,6.4,6.4,0,0,1-1.72,3.13,2.6,2.6,0,0,0-.84,1.37,3.23,3.23,0,0,0,.85.89c.45.28,1.58-.73,1.76-.89a9.28,9.28,0,0,0,2.95-4.5,26.4,26.4,0,0,0,1.38-3.5c.34-1.15,1.12-2.45,1.62-4a41.75,41.75,0,0,1,1.5-4.52l.24-.43s.27-.47.6-.94,2.51-3.06,8.38-9.24c4.51-4.93,7.93-8.7,9.86-10.83,5.57-6.14,7.52-8.32,10.81-11.16A76.68,76.68,0,0,1,61.07,68,3.48,3.48,0,0,0,63.15,67.43Z"/>
                                        <path id="H" class="cls-1 H" fill="#f6f6f6" d="M98,106.3h0a10.15,10.15,0,0,1-4.19-2.36A8.44,8.44,0,0,1,90.87,98a7.9,7.9,0,0,1,1.27-4.12,13,13,0,0,1,6.68-5.43A62.26,62.26,0,0,0,101,106.83,12.26,12.26,0,0,1,98,106.3Z"/>
                                        <path id="G" class="cls-2 G" fill="#f6f6f6" d="M66.8,100.41c-.11,1.85-.32,4-.73,8.26-.14,1.52-.27,2.78-.35,3.64A66.92,66.92,0,0,0,78,114.49h0a66.24,66.24,0,0,0,17.16-.77,64.56,64.56,0,0,0,6.87-1.6l-.78-3.42a13.61,13.61,0,0,1-5-1h0a15.23,15.23,0,0,1-3.63-2.09,9.58,9.58,0,0,1-3.65-5.65h0C88,95.54,90.81,92,91.31,91.39l0,0h0a17,17,0,0,1,5.57-4.2l0,0h0c.61-.31,1.24-.6,1.87-.86V84.67c-2.8.43-5.13.7-6.8.88-14.77,1.6-19.11,0-21.11-.88a20.5,20.5,0,0,1-4.09-2.44c.11,3.44.15,6.37.16,8.61C67,95.37,67,97.64,66.8,100.41Z"/>
                                        <path id="I" class="cls-2 I" fill="#f6f6f6" d="M105.79,138.64c.37,4.23.44,6.49.51,8.82,0,.11,0,.22,0,.33.08,2.46.18,5.11.64,10.28h0c.63,7.08,1.23,10.88,1.75,14.16l.09.56a100.73,100.73,0,0,1,1.27,12.27c0,.3,0,.61,0,.93a103.27,103.27,0,0,0,1.13,11.94h0c.14.91.26,1.75.38,2.55.28,1.9.52,3.52.85,4.94a13.33,13.33,0,0,0,2.36,5.37h0a15.36,15.36,0,0,0,5,4.48,16.11,16.11,0,0,0,4.26,1.52l.56.14a9.31,9.31,0,0,1,5.39,3.38,2.67,2.67,0,0,1,.61,1.85h0a2.53,2.53,0,0,1-.67,1.39,3,3,0,0,1-.66.57h0c-.65.42-1.52.63-5.25-.26a42.1,42.1,0,0,1-4.67-1.38l-.37-.13a13.5,13.5,0,0,0-3.77-.83h0a16.89,16.89,0,0,1-2.83-.38,10.31,10.31,0,0,1-3.53-1.29,6.35,6.35,0,0,1-2.89-3.46,4.92,4.92,0,0,1,0-2.29h0a10.62,10.62,0,0,0-.2-4.45c-.41-1.85-1.17-4.3-2.34-7.85h0c-1.17-3.52-1.79-5.23-2.29-6.62l-.06-.18c-.48-1.3-.86-2.36-1.54-4.46a88.16,88.16,0,0,1-3.28-12,40.3,40.3,0,0,1-.64-5.05v-.13a35.93,35.93,0,0,0-.71-5.12,39,39,0,0,0-1.42-5.17l-.07-.21A46.58,46.58,0,0,1,92,157.92c-1-4.31-1.43-7.46-1.79-10.08-.12-.82-.22-1.59-.34-2.32a77.59,77.59,0,0,0-6.06-20,.51.51,0,0,0-.51-.29.49.49,0,0,0-.43.39l-.07.32-1.1,5.12h0c-1.88,8.86-2.84,13.37-3.5,17.12h0v.07c-.62,3.55-1.18,6.79-1.55,10.46h0c0,.13,0,.32-.05.57-.1,1-.27,2.77-.53,5.25-.17,1.66-.25,2.42-.3,2.89s-.06.53-.09.81h0a32.59,32.59,0,0,0,0,6.06l.06.61a27.22,27.22,0,0,1,.14,4.23h0a8.82,8.82,0,0,1-.57,2.77v0a39.09,39.09,0,0,0-1.36,5.1,105.4,105.4,0,0,0-2.14,15.22h0v.16c-.32,4.91-.48,7.47-.18,9.28h0c.09.55.19,1.06.29,1.53l0,.18c.1.52.19,1,.24,1.4a3.57,3.57,0,0,1-.32,2.21A4.31,4.31,0,0,1,70,218.79a15.32,15.32,0,0,1-2.64.93,9.21,9.21,0,0,1-3.82.34l-.25,0a17.24,17.24,0,0,0-4.41.06,30.89,30.89,0,0,0-4.54,1l-.54.16a11.28,11.28,0,0,1-3.93.57,12.8,12.8,0,0,0-3,0h0c-.38,0-.68.11-1,.17l-.25.05a10.11,10.11,0,0,1-1.27.17h0c-1.14.07-1.52.07-1.85-.13h0a2.21,2.21,0,0,1-.93-2.2A2.86,2.86,0,0,1,43,218.1a5,5,0,0,1,2.37-.76c.35,0,.7,0,1.08-.05h.18c.44,0,.91,0,1.41-.09h0c2.48-.3,4.26-1.57,7.52-3.91l.09-.07h0a27.4,27.4,0,0,0,5.93-5.35c3.55-4.78,2.77-11,2.28-14.91,0-.14,0-.28,0-.41a192.18,192.18,0,0,1-1.06-20.37c-.07-3.62-.13-7.24-.3-10.87a199.55,199.55,0,0,1,0-25.78,159.28,159.28,0,0,1,3-21c1,.31,2.16.67,3.59,1h0A53.76,53.76,0,0,0,81.81,117h0a73.71,73.71,0,0,0,14.07-1.17c2.53-.45,4.68-1,6.33-1.42A209.59,209.59,0,0,1,105.79,138.64Zm0,0,.49,0m-.49,0h0l.49,0"/>
                                        <g id="Letters">
                                            <path class="cls-3" d="M87.62,16.66h2.46l1-3h4.4l.95,3h2.56L94.72,5h-3Zm3.92-4.75.44-1.3c.39-1.22.83-2.57,1.2-3.84h.07c.4,1.25.84,2.62,1.24,3.84l.43,1.3Z"/>
                                            <path class="cls-3" d="M82.68,35a5.56,5.56,0,0,0,4.18-1.7L85.6,31.79A4.1,4.1,0,0,1,82.79,33c-2.18,0-3.6-1.47-3.6-4s1.41-4,3.57-4a4,4,0,0,1,2.56,1l1.27-1.49A5.67,5.67,0,0,0,82.73,23c-3.45,0-5.91,2.27-5.91,6.08S79.34,35,82.68,35Z"/>
                                            <path class="cls-3" d="M40.92,25.49h4.59c3.08,0,4.93-1,4.93-3.42a2.69,2.69,0,0,0-2.39-2.75v-.06a2.56,2.56,0,0,0,1.71-2.51c0-2.21-1.86-2.92-4.61-2.92H40.92Zm2.3-6.89v-3h2c1.47,0,2.27.4,2.27,1.49s-.83,1.51-2.32,1.51Zm0,5.1V20.34h2.23c1.8,0,2.68.47,2.68,1.6,0,1.29-.91,1.76-2.65,1.76Z"/>
                                            <path class="cls-3" d="M79.83,54.89V43.24H83.3c4,0,6.39,1.83,6.39,5.77s-2.43,5.88-6.25,5.88ZM82.12,53h1.07c2.52,0,4.12-1.1,4.12-4s-1.6-3.9-4.12-3.9H82.12Z"/>
                                            <path class="cls-3" d="M41,77.93H49.2V76H43.33V72.89h4.34v-2H43.33V68.2H49V66.27H41Z"/>
                                            <path class="cls-3" d="M112.58,77.93h8.17V76h-5.86V72.89h4.34v-2h-4.34V68.2h5.66V66.27h-8Z"/>
                                            <path class="cls-3" d="M79,105.09a6.1,6.1,0,0,0,4.14-1.4V98.48H78.6v1.9h2.51v2.26A4,4,0,1,1,79,95a3.88,3.88,0,0,1,2.69,1L83,94.55a6.14,6.14,0,0,0-10.17,4.58C72.85,103,75.47,105.09,79,105.09Z"/>
                                            <path class="cls-3" d="M95.17,102.43h2.32v-5h5.36v5h2.29V90.78h-2.29v4.63H97.49V90.78H95.17Z"/>
                                            <path class="cls-3" d="M93.41,144.58h8.65v-1.91H98.88v-7.78h3.18v-2H93.41v2h3.13v7.78H93.41Z"/>
                                            <path class="cls-4" d="M63.57,26.05l-6.24-6.24a1,1,0,0,1,0-1.39l6.24-6.24A1,1,0,1,1,65,13.57l-4.56,4.56H76.16v2H60.39L65,24.66a1,1,0,1,1-1.38,1.39Z"/>
                                            <path class="cls-3" d="M81.45,78.42h2.3V73.73h4.41v-2H83.75V68.69h5.73V66.76h-8Z"/>
                                        </g>
                                        <g id="Scaler">
                                            <path class="cls-5" d="M1.66,250h71v-5h-71Z"/>
                                            <path class="cls-6" d="M4.62,236.75h6.31V238H4.62ZM4.43,239h6.71v1.27H4.43Zm3.9-1.83H9.69v5.79H8.33Zm-2.54.05H7.12v2.49a4.41,4.41,0,0,1-1.72,3.49,4.58,4.58,0,0,0-1-.9,3.12,3.12,0,0,0,1.39-2.6Zm-2.71-3.95H6.35v1H3.08Zm6,0H12.4v1H9.11Zm2.68-1.79h1.53v9.91c0,.78-.14,1.22-.61,1.48a4.64,4.64,0,0,1-2.16.29,5.48,5.48,0,0,0-.45-1.55c.57,0,1.22,0,1.41,0s.28-.08.28-.28Zm-8.57,0H7.34v4.63H3.22V235H5.87v-2.39H3.22Zm9.36,0v1.12H9.67V235h2.91v1.12H8.18v-4.66Zm-10.28,0H3.83v11.72H2.3Z"/>
                                            <path class="cls-6" d="M18.14,234.68h1.63v6.21c0,.64.1.73.71.73h1.78c.64,0,.74-.43.85-2.47a4.29,4.29,0,0,0,1.45.68c-.18,2.44-.61,3.21-2.17,3.21H20.27c-1.66,0-2.13-.51-2.13-2.15Zm.05-2.47,1-1.21a20.06,20.06,0,0,1,4.37,2.27l-1,1.38A17.69,17.69,0,0,0,18.19,232.21ZM15.8,235.6l1.54.31A12.22,12.22,0,0,1,16,241l-1.46-.84A10.09,10.09,0,0,0,15.8,235.6Zm7.49.21,1.43-.72a13.64,13.64,0,0,1,2.37,4.71l-1.59.78A13.83,13.83,0,0,0,23.29,235.81Z"/>
                                            <path class="cls-6" d="M34.87,231.83H46.2v1.6H34.87Zm6.28,4.36,1.21-1a35.62,35.62,0,0,1,4.34,3.55l-1.33,1.2A31.81,31.81,0,0,0,41.15,236.19Zm-.52-3.77,1.74.61A17,17,0,0,1,35.53,240a10.46,10.46,0,0,0-1.07-1.41A13.59,13.59,0,0,0,40.63,232.42Zm-1,3.14,1.71-1.7v9.28H39.68Z"/>
                                            <path class="cls-6" d="M50.38,236.75h6.3V238h-6.3Zm-.2,2.22h6.71v1.27H50.18Zm3.9-1.83h1.37v5.79H54.08Zm-2.53.05h1.32v2.49a4.43,4.43,0,0,1-1.71,3.49,4.82,4.82,0,0,0-1-.9,3.15,3.15,0,0,0,1.39-2.6Zm-2.72-3.95h3.28v1H48.83Zm6,0h3.29v1H54.86Zm2.68-1.79h1.53v9.91c0,.78-.14,1.22-.61,1.48a4.62,4.62,0,0,1-2.16.29,4.9,4.9,0,0,0-.45-1.55c.57,0,1.22,0,1.42,0s.27-.08.27-.28Zm-8.57,0h4.12v4.63H49V235h2.65v-2.39H49Zm9.36,0v1.12H55.42V235h2.91v1.12H53.94v-4.66Zm-10.28,0h1.53v11.72H48.05Z"/>
                                            <path class="cls-6" d="M63.9,234.68h1.62v6.21c0,.64.11.73.72.73H68c.63,0,.74-.43.84-2.47a4.34,4.34,0,0,0,1.46.68c-.18,2.44-.61,3.21-2.17,3.21H66c-1.67,0-2.13-.51-2.13-2.15Zm.05-2.47L65,231a19.83,19.83,0,0,1,4.37,2.27l-1,1.38A17.8,17.8,0,0,0,64,232.21Zm-2.39,3.39,1.53.31A11.93,11.93,0,0,1,61.7,241l-1.46-.84A10.09,10.09,0,0,0,61.56,235.6Zm7.48.21,1.43-.72a13.47,13.47,0,0,1,2.37,4.71l-1.59.78A13.83,13.83,0,0,0,69,235.81Z"/>
                                        </g>
                                    </g>
                                </g>
                            </svg>
                            
                            <div class="emofeel-right">
                                <div class="emofeel-right-top">
                                    <select class="emofeel-select" name="body_part">
                                        <option value="A" selected>Ａ: 頭</option>
                                        <option value="B">Ｂ: 眼</option>
                                        <option value="C">Ｃ: 臉</option>
                                        <option value="D">Ｄ: 肩頸</option>
                                        <option value="E">Ｅ: 上肢</option>
                                        <option value="F">Ｆ: 胸腔</option>
                                        <option value="G">Ｇ: 腹部（胃）</option>
                                        <option value="H">Ｈ: 腰</option>
                                        <option value="I">Ｉ: 下肢</option>
                                    </select>
                                    <p class="font remark-string">平均開心程度:
                                        <span class="happy-avg" style="color: #FF4A3E;">
                                            <% if viz_4[:emofeel_by_bodyparts]["A"] != 0 %>
                                                <%= viz_4[:emofeel_by_bodyparts]["A"][:happy_score] %>
                                            <% else %>
                                                -
                                            <% end %>
                                        </span>
                                        /10 分
                                    </p>
                                </div>
                                <div class="form-record-ans emo-feel-lines">
                                    <% if viz_4[:emofeel_by_bodyparts]["A"] != 0 %>
                                        <% viz_4[:emofeel_by_bodyparts]["A"][:emo_feel].each do |line| %>
                                            <p class="font content">
                                                <span> <%= line[1] %> </span> 因為 <span> <%= line[0] %> </span> 
                                            </p>
                                        <% end %>
                                    <% else %>
                                        <p class="font content no-record-text">查無紀錄資料</p>
                                    <% end %>
                                </div>
                            </div>
                        <% else %>
                            <p class="font content no-record-text">查無紀錄資料</p>
                        <% end %>
                    </div>
                </div>
            </div>

            <div class="navbar-div">
                <div class="navbar-div-bottom">
                    <a href='/fomo-dic'>
                        <img src="/fomo-dic.png" width="97px">
                    </a>

                    <a href='/my-history/<%= account %>'>
                        <img src="/my-history.png" width="97px">
                    </a>
                </div>

                <% if is_record %>
                    <input class="start_btn small-btn-string font" type="button" disabled="disabled" style="color: #AACFD1;" value="已完成&#x00A;今日紀錄">
                <% else %>
                    <a href='/meditation/<%= account %>'>
                        <input class="start_btn big-btn-string font" type="button" value="開始&#x00A;記錄">
                    </a>
                <% end %>
            </div>

            <!-- footer -->
            <p class="font content footer">
                © Copyright 2023 NTHU ISS - SoMate Research Team
            </p>
        </div>
        
    </div>
    <script>
        $(".emofeel-select").on("change", function(){
            var selected_bodypart = $(this).val();
            var lines_content = "";
            var happy_avg = "";

            // get value from ruby
            $.ajax({
                type: 'POST',
                url: '/get-viz4-arr',
                data: { 
                    selected_bodypart: selected_bodypart,
                    start_date: $(".viz-4-date").attr("start-date"),
                    end_date: $(".viz-4-date").attr("end-date"),
                    userid: <%= user.id %>
                },
                success: function(response) {
                    if (response != "{}") {
                        response_arr = JSON.parse(response)
                        emo_feel = response_arr[selected_bodypart]["emo_feel"];
                        happy_avg = response_arr[selected_bodypart]["happy_score"];
                        emo_feel.forEach(function(line) {
                            lines_content += `<p class="font content">
                                                <span> ${line[1]} </span> 因為 <span> ${line[0]} </span> 
                                            </p>`;
                        });
                    } else {
                        happy_avg = '-'
                        lines_content = '<p class="font content no-record-text" style="padding:0;">（無資料）</p>';
                    }

                    // update the contents (viz_4)
                    $(".happy-avg").html(happy_avg);
                    $(".emo-feel-lines").html(lines_content);
                },
                error: function(xhr, status, error) {
                }
            });
        });

        $(document).ready(function() {
            // viz 1 chart
            var data_viz1 = <%= viz_1[:data].to_json %>;
            // viz 3 chart
            var data_viz3 = <%= viz_3[:data].to_json %>;

            // 根據 data 看 line chart 對應的點的圖片要顯示哪一個
            const pointImg_happy = new Image(28, 28);
            const pointImg_normal = new Image(28, 28);
            const pointImg_unhappy = new Image(28, 28);
            pointImg_happy.src = "/emoji-happy.png";
            pointImg_normal.src = "/emoji-normal.png";
            pointImg_unhappy.src = "/emoji-unhappy.png";
            var happy_scores_arr_viz1 = data_viz1.datasets[0].data;
            var line_points_viz1 = [];
            happy_scores_arr_viz1.forEach(function(current_happy_score) {
                if(current_happy_score == 0) {
                    line_points_viz1.push("line");
                } else if(current_happy_score == 5) {
                    line_points_viz1.push(pointImg_happy);
                }  else if(current_happy_score > 5) {
                    line_points_viz1.push(pointImg_happy);
                } else {
                    line_points_viz1.push(pointImg_unhappy);
                }
            });
            var happy_scores_arr_viz3 = data_viz3.datasets[0].data;
            var line_points_viz3 = [];
            happy_scores_arr_viz3.forEach(function(current_happy_score) {
                if(current_happy_score == 0) {
                    line_points_viz3.push("line");
                } else if(current_happy_score == 5) {
                    line_points_viz3.push(pointImg_happy);
                }  else if(current_happy_score > 5) {
                    line_points_viz3.push(pointImg_happy);
                } else {
                    line_points_viz3.push(pointImg_unhappy);
                }
            });

            var options_viz1 = {
                responsive: true,
                maintainAspectRatio: false,
                elements: {
                    point: {
                        pointStyle: line_points_viz1     // line chart 上每個點對應的圖示
                    }
                },
                scales: {
                    "bar-y-axis": { position: 'left', display: false, },
                    "line-y-axis": { position: 'right', display: false, min: 0, max: 10 }
                },
                onClick: function(event, elements) {
                    // 導向至當天詳細的內容
                    var clickedIndex = elements[0].index;
                    var record_ids = <%= viz_1[:record_ids].to_json %>;
                    if (typeof(clickedIndex) === typeof(0) && record_ids[clickedIndex] != 0) {
                        // record_ids[clickedIndex] ==0 >> 沒有資料
                        window.location.href = "/form_record/" + record_ids[clickedIndex];
                    }
                },
                plugins: {
                    // data labels
                    datalabels: {
                        anchor: "end",
                        align: "bottom",
                        offset: "1",
                        color: "white",
                        font: {
                            weight: '700',
                        },
                        formatter: function(value, context) {
                            // 檢查資料集索引以判斷是否要顯示標籤
                            if (context.datasetIndex === 0) {
                                return ''; // 取消特定資料集的標籤，返回空字串
                            } else {
                                return value === 0 ? '' : value; // 資料 == 0 時不顯示
                            }
                        }
                    }
                }
            };
            var options_viz3 = {
                responsive: true,
                maintainAspectRatio: false,
                elements: {
                    point: {
                        pointStyle: line_points_viz3     // line chart 上每個點對應的圖示
                    }
                },
                scales: {
                    x: {
                        // label 字數超過三個字之後顯示 ... (但還是可以用點選的方式知道完整的活動)
                        ticks: {
                            callback: function(value, index, ticks_array) {
                                let label = this.getLabelForValue(value);
                                return label.length >= 3 ? label.substring(0, 3) + '...' : label
                            }
                        },
                        maxRotation: 0,
                        autoSkip: false
                    },
                    "bar-y-axis": { position: 'left', display: false, min: 0, max: 7},
                    "line-y-axis": { position: 'right', display: false, min: 0, max: 10 }
                },
                plugins: {
                    // data labels
                    datalabels: {
                        anchor: "end",
                        align: function(value, context) {
                            if (value.datasetIndex == 1) {      // value.datasetIndex == 1: bar chart
                                return value.dataset.data[value.dataIndex] > 1 ? "bottom" : "top";
                            }
                        },
                        offset: "1",
                        color: function(value, context) {
                            if (value.datasetIndex == 1) {      // value.datasetIndex == 1: bar chart
                                return value.dataset.data[value.dataIndex] > 1 ? "white" : "#AACFD1";
                            }
                        },
                        font: {
                            weight: '700',
                        },
                        formatter: function(value, context) {
                            // 檢查資料集索引以判斷是否要顯示標籤
                            if (context.datasetIndex === 0) {
                                return ''; // 取消特定資料集的標籤，返回空字串
                            } else {
                                return value === 0 ? '' : value; // 資料 == 0 時不顯示
                            }
                        }
                    }
                }
            };

            // create viz_1
            var ctx = document.getElementById('viz-1-chart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: data_viz1,
                options: options_viz1,
                plugins:[ChartDataLabels]
            });
            // create viz_3
            var ctx = document.getElementById('viz-3-chart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: data_viz3,
                options: options_viz3,
                plugins:[ChartDataLabels]
            });

            // viz_4: change bodyparts visualization svg fill color
            var bodyparts_viz_data = <%= viz_4[:emofeel_by_bodyparts].to_json %>;
            Object.entries(bodyparts_viz_data).forEach(function([key, value]) {
                var bodypart = key;
                var happy_score = value["happy_score"];
                var green = 188 + 6 * happy_score;
                var blue = 18 + 20.5 * happy_score;
                $("path." + bodypart).attr("fill", "rgb(255, " + green + ", " + blue + ")");
            });
        });
    </script>
</body>